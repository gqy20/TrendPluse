# TrendPulse MVP æŠ€æœ¯æ–¹æ¡ˆ v2.0

> åŸºäºå¼€æºåŒ…è°ƒç ”çš„å®Œå–„ç‰ˆæœ¬

## ä¸€ã€ç«å“åˆ†æï¼šç°æœ‰ GitHub åˆ†æå·¥å…·

### 1.1 å·²æœ‰å¼€æºæ–¹æ¡ˆè°ƒç ”

| å·¥å…· | Star æ•° | åŠŸèƒ½å®šä½ | ä¸æˆ‘ä»¬çš„å·®å¼‚ |
|------|---------|----------|--------------|
| **OSS Insight** | 11k+ | å…¨é¢çš„ GitHub æ•°æ®åˆ†æå¹³å° | âœ… æ•°æ®é©±åŠ¨ï¼Œæ—  AI åˆ†æï¼›ğŸ¯ æˆ‘ä»¬èšç„¦è¶‹åŠ¿ä¿¡å·æå– |
| **PR-Agent** | 8k+ | AI é©±åŠ¨çš„ PR ä»£ç å®¡æŸ¥ | âœ… å• PR æ·±åº¦åˆ†æï¼›ğŸ¯ æˆ‘ä»¬åšå¤šäº‹ä»¶èšåˆ |
| **RepoSense** | 1.5k+ | ä»£ç è´¡çŒ®å¯è§†åŒ–åˆ†æ | âœ… è´¡çŒ®åº¦ç»Ÿè®¡ï¼›ğŸ¯ æˆ‘ä»¬åšæŠ€æœ¯è¶‹åŠ¿åˆ†æ |
| **git-cliff** | 3k+ | ä» commits ç”Ÿæˆ changelog | âœ… åŸºäºæäº¤æ¶ˆæ¯ï¼›ğŸ¯ æˆ‘ä»¬åŸºäº AI ç†è§£ |
| **conventional-changelog** | 8k+ | Conventional Commits è§„èŒƒ | âœ… éœ€è¦è§„èŒƒéµå®ˆï¼›ğŸ¯ æˆ‘ä»¬ç†è§£ä»»æ„æè¿° |
| **Weekly-Report-Generator** | <500 | ä¸ªäººå‘¨æŠ¥ç”Ÿæˆ | âœ… é¢å‘ä¸ªäººï¼›ğŸ¯ æˆ‘ä»¬é¢å‘ç»„ç»‡/é¡¹ç›® |
| **github-org-metrics** | <500 | ç»„ç»‡çº§åˆ«æŒ‡æ ‡åˆ†æ | âœ… ç»Ÿè®¡æŒ‡æ ‡ï¼›ğŸ¯ æˆ‘ä»¬åšè¶‹åŠ¿æ´å¯Ÿ |

### 1.2 å·®å¼‚åŒ–å®šä½

```
ç°æœ‰å·¥å…·çš„åˆ†ç±»ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•°æ®ç»Ÿè®¡ç±»                                                  â”‚
â”‚  - OSS Insight: å¤§æ•°æ®åˆ†æå¹³å°                              â”‚
â”‚  - RepoSense: è´¡çŒ®åº¦å¯è§†åŒ–                                  â”‚
â”‚  - github-org-metrics: ç»„ç»‡æŒ‡æ ‡                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Changelog ç”Ÿæˆç±»                                            â”‚
â”‚  - git-cliff: åŸºäº commits ç”Ÿæˆ                             â”‚
â”‚  - conventional-changelog: è§„èŒƒé©±åŠ¨                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI ä»£ç å®¡æŸ¥ç±»                                               â”‚
â”‚  - PR-Agent: å• PR æ·±åº¦åˆ†æ                                 â”‚
â”‚  - CodeSpect: è‡ªåŠ¨åŒ–ä»£ç å®¡æŸ¥                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TrendPulse (æˆ‘ä»¬)                                          â”‚
â”‚  âœ… AI é©±åŠ¨çš„è¶‹åŠ¿ä¿¡å·æå–                                   â”‚
â”‚  âœ… è·¨äº‹ä»¶çš„èšåˆåˆ†æï¼ˆå·¥ç¨‹ + ç ”ç©¶ï¼‰                         â”‚
â”‚  âœ… ç»“æ„åŒ–è¾“å‡º + å¯æµè§ˆç«™ç‚¹                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 å¯å€Ÿé‰´çš„è®¾è®¡

**ä» OSS Insight å€Ÿé‰´**ï¼š
- æ•°æ®å¯è§†åŒ–å±•ç¤ºæ–¹å¼
- GitHub API é«˜æ•ˆæŸ¥è¯¢æ¨¡å¼
- é™æ€ç«™ç‚¹ç”Ÿæˆæ¶æ„

**ä» PR-Agent å€Ÿé‰´**ï¼š
- AI Prompt æ¨¡æ¿è®¾è®¡
- ç»“æ„åŒ–è¾“å‡ºéªŒè¯æœºåˆ¶
- é‡è¯•å’Œé™çº§ç­–ç•¥

**ä» git-cliff å€Ÿé‰´**ï¼š
- æ¨¡æ¿å¼•æ“ä½¿ç”¨ï¼ˆJinja2ï¼‰
- å¢é‡æ›´æ–°ç­–ç•¥
- Markdown è¾“å‡ºæ ¼å¼

---

## äºŒã€å¼€æºåŒ…é€‰å‹

### 2.1 æ ¸å¿ƒä¾èµ–

| åŠŸèƒ½ | åŒ…å | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|------|
| **GitHub API** | `PyGithub` | >=2.5.0 | æˆç†Ÿçš„ GitHub REST API å®¢æˆ·ç«¯ï¼Œç±»å‹å®Œå–„ |
| **Claude API** | `instructor` | >=1.6.0 | ç»“æ„åŒ–è¾“å‡ºç¥å™¨ï¼ŒåŸºäº Pydanticï¼Œå†…ç½®é‡è¯•å’ŒéªŒè¯ |
| **Claude SDK** | `anthropic` | >=0.45.0 | å®˜æ–¹ SDKï¼ˆinstructor ä¾èµ–ï¼‰ |
| **é…ç½®ç®¡ç†** | `pydantic-settings` | >=2.6.0 | å®˜æ–¹é…ç½®ç®¡ç†ï¼Œæ”¯æŒç¯å¢ƒå˜é‡ |
| **æ¨¡æ¿å¼•æ“** | `jinja2` | >=3.1.0 | ç”Ÿæˆ Markdown æŠ¥å‘Š |
| **æ—¥å¿—ç³»ç»Ÿ** | `rich` | >=13.0.0 | ç»ˆç«¯ç¾åŒ– + logging handler |
| **é‡è¯•æœºåˆ¶** | `tenacity` | >=9.0.0 | ä¼˜é›…çš„é‡è¯•è£…é¥°å™¨ |
| **å¼‚æ­¥ HTTP** | `aiohttp` | >=3.10.0 | å¼‚æ­¥è¯·æ±‚ï¼ˆå¯é€‰ï¼‰ |

### 2.2 ä¸ºä»€ä¹ˆé€‰æ‹© instructorï¼Ÿ

```python
# åŸæ–¹æ¡ˆï¼šç›´æ¥ä½¿ç”¨ anthropic SDK
response = client.beta.messages.parse(
    model=settings.anthropic_model,
    output_format=DailyReport,  # Beta åŠŸèƒ½
    ...
)

# æ–°æ–¹æ¡ˆï¼šä½¿ç”¨ instructor
import instructor
from anthropic import Anthropic

# è‡ªåŠ¨å¤„ç†é‡è¯•ã€éªŒè¯ã€é”™è¯¯æ¢å¤
client = instructor.from_anthropic(Anthropic())
report = client.messages.create(
    model=settings.anthropic_model,
    response_model=DailyReport,  # ç¨³å®šå¯é 
    messages=[...]
)
```

**ä¼˜åŠ¿**ï¼š
- âœ… ä¸ä¾èµ– Beta åŠŸèƒ½ï¼Œæ›´ç¨³å®š
- âœ… è‡ªåŠ¨é‡è¯•å’ŒéªŒè¯
- âœ… æ”¯æŒå¤šç§æ¨¡å‹ï¼ˆOpenAIã€Anthropicã€æœ¬åœ°ï¼‰
- âœ… æ›´å¥½çš„é”™è¯¯å¤„ç†

---

## ä¸‰ã€ä»ç°æœ‰å·¥å…·å€Ÿé‰´çš„è®¾è®¡æ¨¡å¼

### 3.1 PR-Agent çš„ AI åˆ†ææ¨¡å¼

PR-Agent (qodo-ai/pr-agent) æ˜¯ä¸€ä¸ªéå¸¸æˆç†Ÿçš„ AI PR åˆ†æå·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥å€Ÿé‰´ï¼š

**1. å¤šçº§åˆ†æç­–ç•¥**
```python
# ä» PR-Agent å€Ÿé‰´ï¼šæ ¹æ® PR å¤§å°é€‰æ‹©åˆ†ææ·±åº¦
def analyze_pr(pr: PullRequest) -> Analysis:
    # å° PRï¼šå¿«é€Ÿæ€»ç»“
    if pr.additions + pr.deletions < 100:
        return quick_summary(pr)

    # ä¸­ç­‰ PRï¼šè¯¦ç»†åˆ†æ
    elif pr.additions + pr.deletions < 500:
        return detailed_analysis(pr)

    # å¤§ PRï¼šåˆ†æ®µåˆ†æ
    else:
        return segmented_analysis(pr)
```

**2. Prompt æ¨¡æ¿åŒ–**
```python
# ä» PR-Agent å€Ÿé‰´ï¼šä½¿ç”¨ Jinja2 ç®¡ç† Prompt
ANALYSIS_PROMPTS = {
    "summary": "templates/prompts/summary.md.j2",
    "review": "templates/prompts/review.md.j2",
    "trend": "templates/prompts/trend_analysis.md.j2",
}

def get_prompt(type: str, **context) -> str:
    template = env.get_template(ANALYSIS_PROMPTS[type])
    return template.render(**context)
```

### 3.2 git-cliff çš„æ¨¡æ¿å¼•æ“ä½¿ç”¨

git-cliff æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ changelog ç”Ÿæˆå™¨ï¼Œå…¶æ¨¡æ¿è®¾è®¡å€¼å¾—å­¦ä¹ ï¼š

**1. å¤šæ ¼å¼è¾“å‡ºæ”¯æŒ**
```python
# ä» git-cliff å€Ÿé‰´ï¼šä¸€ä¸ªæ¨¡æ¿å¼•æ“ï¼Œå¤šç§è¾“å‡º
class ReportRenderer:
    def render(self, report: DailyReport, format: str = "markdown") -> str:
        if format == "markdown":
            return self._render_markdown(report)
        elif format == "json":
            return report.model_dump_json(indent=2)
        elif format == "html":
            return self._render_html(report)

    def _render_markdown(self, report: DailyReport) -> str:
        return self.md_template.render(report=report)

    def _render_html(self, report: DailyReport) -> str:
        return self.html_template.render(report=report)
```

**2. å¢é‡æ›´æ–°ç­–ç•¥**
```python
# ä» git-cliff å€Ÿé‰´ï¼šåªå¤„ç†æ–°çš„å˜æ›´
def get_new_events_since_last_run() -> list[Event]:
    last_run_file = Path("data/last_run.txt")
    if last_run_file.exists():
        last_run = datetime.fromisoformat(last_run_file.read_text())
    else:
        last_run = datetime.now() - timedelta(days=1)

    events = fetch_events(since=last_run)
    return events
```

### 3.3 OSS Insight çš„æ•°æ®å¯è§†åŒ–

OSS Insight ä½¿ç”¨ TiDB å¤„ç†æµ·é‡ GitHub æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥å€Ÿé‰´å…¶å±•ç¤ºæ–¹å¼ï¼š

**1. ä¿¡å·åˆ†ç±»å±•ç¤º**
```markdown
# ä» OSS Insight å€Ÿé‰´ï¼šæ¸…æ™°çš„åˆ†ç±»å±•ç¤º
## å·¥ç¨‹è¶‹åŠ¿ä¿¡å·

### ğŸš€ æ–°èƒ½åŠ›
- [5/5] Structured Output Support
- [4/5] Streaming Response API

### ğŸ”§ å·¥å…·é“¾
- [3/5] New CLI Tool
- [2/5] Improved Error Messages

## ç ”ç©¶è¶‹åŠ¿ä¿¡å·

### ğŸ§ª Agent Workflows
- [5/5] Multi-Agent Collaboration
- [4/5] Tool Use Patterns

### ğŸ“Š Eval Systems
- [3/5] New Benchmarks
```

**2. æ—¶é—´çº¿è§†å›¾**
```python
# ä» OSS Insight å€Ÿé‰´ï¼šæŒ‰æ—¶é—´ç»„ç»‡
def organize_by_timeline(signals: list[Signal]) -> dict[str, list[Signal]]:
    """å°†ä¿¡å·æŒ‰æ—¶é—´åˆ†ç»„"""
    timeline = {}
    for signal in signals:
        date = signal.date[:7]  # YYYY-MM
        if date not in timeline:
            timeline[date] = []
        timeline[date].append(signal)
    return timeline
```

---

## å››ã€é¡¹ç›®ç»“æ„ï¼ˆuv + src layoutï¼‰

```
trendpluse/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ daily.yml          # GitHub Actions
â”œâ”€â”€ src/
â”‚   â””â”€â”€ trendpluse/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ main.py            # CLI å…¥å£
â”‚       â”œâ”€â”€ config.py          # é…ç½®ç®¡ç†
â”‚       â”œâ”€â”€ logger.py          # Rich æ—¥å¿—ç³»ç»Ÿ
â”‚       â”œâ”€â”€ models/
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â””â”€â”€ signal.py      # Pydantic æ•°æ®æ¨¡å‹
â”‚       â”œâ”€â”€ github/
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ client.py      # PyGithub å°è£…
â”‚       â”‚   â””â”€â”€ models.py      # GitHub æ•°æ®æ¨¡å‹
â”‚       â”œâ”€â”€ analyzer/
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ claude.py      # Instructor åˆ†æå™¨
â”‚       â”‚   â””â”€â”€ prompts.py     # Prompt æ¨¡æ¿
â”‚       â”œâ”€â”€ pipeline/
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ fetch.py       # Stage 1: æ‹‰å–
â”‚       â”‚   â”œâ”€â”€ filter.py      # Stage 2: ç­›é€‰
â”‚       â”‚   â”œâ”€â”€ analyze.py     # Stage 3: åˆ†æ
â”‚       â”‚   â””â”€â”€ render.py      # Stage 4: æ¸²æŸ“
â”‚       â””â”€â”€ utils/
â”‚           â”œâ”€â”€ __init__.py
â”‚           â”œâ”€â”€ retry.py       # Tenacity é‡è¯•é…ç½®
â”‚           â””â”€â”€ templates.py   # Jinja2 æ¨¡æ¿ç®¡ç†
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ conftest.py            # pytest fixtures
â”‚   â”œâ”€â”€ test_github.py         # GitHub API æµ‹è¯•
â”‚   â”œâ”€â”€ test_analyzer.py       # åˆ†æå™¨æµ‹è¯•ï¼ˆmockï¼‰
â”‚   â””â”€â”€ test_pipeline.py       # ç«¯åˆ°ç«¯æµ‹è¯•
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ snapshots/             # åŸå§‹æ•°æ®
â”‚   â”œâ”€â”€ processed/             # å¤„ç†åæ•°æ®
â”‚   â””â”€â”€ fallback/              # é™çº§æ•°æ®
â”œâ”€â”€ reports/
â”‚   â””â”€â”€ daily/                 # æ¯æ—¥æŠ¥å‘Šï¼ˆJSON + Markdownï¼‰
â”œâ”€â”€ docs/                      # MkDocs æº
â”œâ”€â”€ templates/                 # Jinja2 æ¨¡æ¿
â”‚   â””â”€â”€ daily_report.md.j2
â”œâ”€â”€ scripts/                   # è¾…åŠ©è„šæœ¬
â”‚   â””â”€â”€ mock_data.py           # ç”Ÿæˆæµ‹è¯•æ•°æ®
â”œâ”€â”€ pyproject.toml             # uv é¡¹ç›®é…ç½®
â”œâ”€â”€ uv.lock                    # uv é”æ–‡ä»¶
â”œâ”€â”€ .env.example               # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ Makefile                   # å¸¸ç”¨å‘½ä»¤
â”œâ”€â”€ mkdocs.yml
â””â”€â”€ README.md
```

---

## äº”ã€æ ¸å¿ƒä»£ç å®ç°ï¼ˆåŸºäºå¼€æºåŒ…ï¼‰

### 5.1 é…ç½®ç®¡ç†ï¼ˆpydantic-settingsï¼‰

```python
# src/trendpluse/config.py
from pydantic import Field, field_validator
from pydantic_settings import BaseSettings, SettingsConfigDict

class Settings(BaseSettings):
    """é…ç½®ç®¡ç†ï¼Œæ”¯æŒç¯å¢ƒå˜é‡å’Œ .env"""

    model_config = SettingsConfigDict(
        env_file=".env",
        env_file_encoding="utf-8",
        env_prefix="TRENDPULSE_",
        extra="ignore",
    )

    # GitHub é…ç½®
    github_token: str = Field(description="GitHub Personal Access Token")
    github_repos: list[str] = Field(
        default=["anthropics/anthropic-sdk-python"],
        description="è¦è¿½è¸ªçš„ä»“åº“åˆ—è¡¨"
    )
    github_base_url: str = "https://api.github.com"

    # Anthropic é…ç½®
    anthropic_api_key: str = Field(description="Anthropic API Key")
    anthropic_model: str = "claude-sonnet-4-5"
    anthropic_max_tokens: int = 8000
    anthropic_timeout: int = 120

    # ç­›é€‰è§„åˆ™
    candidate_labels: list[str] = [
        "feature", "enhancement", "eval", "tooling",
        "agent", "workflow", "safety"
    ]
    max_candidates: int = 20
    days_to_lookback: int = 1  # æŸ¥çœ‹è¿‡å»å‡ å¤©çš„æ•°æ®

    # æˆæœ¬æ§åˆ¶
    daily_token_budget: int = 100_000
    max_retries: int = 3

    # è¾“å‡ºé…ç½®
    output_dir: str = "reports/daily"
    snapshot_dir: str = "data/snapshots"

    @field_validator("github_repos")
    @classmethod
    def validate_repos(cls, v: list[str]) -> list[str]:
        """éªŒè¯ä»“åº“æ ¼å¼"""
        for repo in v:
            if "/" not in repo or len(repo.split("/")) != 2:
                raise ValueError(f"Invalid repo format: {repo}")
        return v

settings = Settings()
```

### 5.2 æ—¥å¿—ç³»ç»Ÿï¼ˆrichï¼‰

```python
# src/trendpluse/logger.py
import logging
from pathlib import Path
from rich.console import Console
from rich.logging import RichHandler

def setup_logger(name: str = "trendpluse", level: str = "INFO") -> logging.Logger:
    """é…ç½® Rich æ—¥å¿—ç³»ç»Ÿ"""

    logger = logging.getLogger(name)
    logger.setLevel(getattr(logging, level.upper()))

    # æ¸…é™¤ç°æœ‰ handlers
    logger.handlers.clear()

    # Rich ç»ˆç«¯è¾“å‡º
    console = Console()
    handler = RichHandler(
        console=console,
        show_time=True,
        show_path=True,
        rich_tracebacks=True,
        tracebacks_show_locals=True,
    )
    handler.setFormatter(logging.Formatter("%(message)s"))
    logger.addHandler(handler)

    # æ–‡ä»¶è¾“å‡ºï¼ˆå¯é€‰ï¼‰
    log_dir = Path("logs")
    log_dir.mkdir(exist_ok=True)
    file_handler = logging.FileHandler(log_dir / f"{name}.log")
    file_handler.setFormatter(
        logging.Formatter("%(asctime)s - %(name)s - %(levelname)s - %(message)s")
    )
    logger.addHandler(file_handler)

    return logger

logger = setup_logger()
```

### 5.3 GitHub å®¢æˆ·ç«¯ï¼ˆPyGithubï¼‰

```python
# src/trendpluse/github/client.py
from datetime import datetime, timedelta
from typing import Any

from github import Github, GithubException
from tenacity import retry, stop_after_attempt, wait_exponential

from ..config import settings
from ..logger import logger
from .models import RepoEvent, PullRequestEvent, ReleaseEvent

class GitHubClient:
    """GitHub API å®¢æˆ·ç«¯å°è£…"""

    def __init__(self, token: str | None = None):
        token = token or settings.github_token
        self.client = Github(token, per_page=100)
        self._rate_limit_remain: int | None = None

    @retry(
        stop=stop_after_attempt(3),
        wait=wait_exponential(multiplier=1, min=2, max=10),
        retry_error_callback=lambda _: None,
    )
    def get_events(
        self,
        repos: list[str] | None = None,
        days: int = 1,
    ) -> list[RepoEvent]:
        """è·å–æŒ‡å®šä»“åº“çš„æœ€è¿‘äº‹ä»¶"""

        repos = repos or settings.github_repos
        since = datetime.now() - timedelta(days=days)

        logger.info(f"Fetching events from {len(repos)} repos since {since}")

        all_events: list[RepoEvent] = []

        for repo_name in repos:
            try:
                repo = self.client.get_repo(repo_name)
                events = self._fetch_repo_events(repo, since)
                all_events.extend(events)
                logger.info(f"Found {len(events)} events in {repo_name}")

            except GithubException as e:
                logger.error(f"Failed to fetch {repo_name}: {e}")
                continue

        return all_events

    def _fetch_repo_events(
        self,
        repo: Any,  # github.Repository.Repository
        since: datetime,
    ) -> list[RepoEvent]:
        """è·å–å•ä¸ªä»“åº“çš„äº‹ä»¶"""

        events: list[RepoEvent] = []

        # è·å–å·²åˆå¹¶çš„ PR
        pulls = repo.get_pulls(
            state="closed",
            sort="updated",
            direction="desc",
        )
        for pull in pulls:
            if pull.merged_at and pull.merged_at > since:
                events.append(
                    PullRequestEvent(
                        number=pull.number,
                        title=pull.title,
                        body=pull.body or "",
                        state="merged",
                        merged_at=pull.merged_at.isoformat(),
                        author=pull.user.login,
                        labels=[label.name for label in pull.labels],
                        url=pull.html_url,
                        diff_summary=self._get_diff_summary(pull),
                    )
                )

        # è·å– Releases
        releases = repo.get_releases()
        for release in releases:
            if release.created_at > since:
                events.append(
                    ReleaseEvent(
                        tag_name=release.tag_name,
                        name=release.title or release.tag_name,
                        body=release.body or "",
                        url=release.html_url,
                        created_at=release.created_at.isoformat(),
                    )
                )

        return events

    def _get_diff_summary(self, pull: Any) -> str:
        """è·å– PR çš„ diff æ‘˜è¦ï¼ˆå‰ 2000 å­—ç¬¦ï¼‰"""
        try:
            # ä½¿ç”¨ Files API è·å–å˜æ›´æ–‡ä»¶
            files = pull.get_files()
            summary_parts = []
            total_chars = 0
            max_chars = 2000

            for file in files:
                if total_chars >= max_chars:
                    break
                file_summary = f"\n- {file.filename}: {file.status} (+{file.additions}, -{file.deletions})"
                if total_chars + len(file_summary) > max_chars:
                    summary_parts.append(f"\n- ... ({len(list(files))} files changed)")
                    break
                summary_parts.append(file_summary)
                total_chars += len(file_summary)

            return "".join(summary_parts)[:max_chars]

        except Exception as e:
            logger.warning(f"Failed to get diff for PR #{pull.number}: {e}")
            return ""
```

### 5.4 åˆ†æå™¨ï¼ˆinstructorï¼‰

```python
# src/trendpluse/analyzer/claude.py
from anthropic import Anthropic
from instructor import from_anthropic

from ..config import settings
from ..logger import logger
from ..models.signal import DailyReport
from .prompts import build_analysis_prompt

class ClaudeAnalyzer:
    """åŸºäº Instructor çš„ Claude åˆ†æå™¨"""

    def __init__(self, api_key: str | None = None):
        api_key = api_key or settings.anthropic_api_key

        # åˆ›å»º instructor å®¢æˆ·ç«¯ï¼ˆè‡ªåŠ¨å¤„ç†é‡è¯•å’ŒéªŒè¯ï¼‰
        self.client = from_anthropic(
            Anthropic(api_key=api_key),
            mode=instructor.Mode.JSON,
        )

    def analyze(self, candidates: list[dict]) -> DailyReport:
        """åˆ†æå€™é€‰äº‹ä»¶ï¼Œæå–è¶‹åŠ¿ä¿¡å·"""

        logger.info(f"Analyzing {len(candidates)} candidates with Claude")

        try:
            # ä½¿ç”¨ instructor çš„ç»“æ„åŒ–è¾“å‡º
            report: DailyReport = self.client.messages.create(
                model=settings.anthropic_model,
                response_model=DailyReport,
                max_tokens=settings.anthropic_max_tokens,
                messages=[{
                    "role": "user",
                    "content": build_analysis_prompt(candidates),
                }],
            )

            logger.info(
                f"Generated {len(report.engineering_signals) + len(report.research_signals)} signals"
            )
            return report

        except Exception as e:
            logger.error(f"Analysis failed: {e}")
            raise

    def estimate_tokens(self, candidates: list[dict]) -> int:
        """ä¼°ç®— token æ¶ˆè€—"""
        # ç²—ç•¥ä¼°ç®—ï¼šæ¯ä¸ªå­—ç¬¦çº¦ 0.25 tokens
        text = str(candidates)
        return int(len(text) * 0.25)
```

### 5.5 Prompt æ¨¡æ¿ï¼ˆJinja2ï¼‰

```python
# src/trendpluse/analyzer/prompts.py
from jinja2 import Template

ANALYSIS_PROMPT_TEMPLATE = Template("""
ä½ æ˜¯ Anthropic æŠ€æœ¯è¶‹åŠ¿åˆ†æä¸“å®¶ã€‚åˆ†æä»¥ä¸‹ GitHub æ›´æ–°ï¼Œæå–è¶‹åŠ¿ä¿¡å·ã€‚

# åˆ†æç›®æ ‡

1. **å·¥ç¨‹è¶‹åŠ¿ä¿¡å·**ï¼šSDK API æ–°èƒ½åŠ›ã€æ–°æŠ½è±¡ã€å·¥å…·é“¾å˜åŒ–
2. **ç ”ç©¶è¶‹åŠ¿ä¿¡å·**ï¼šagent workflowã€eval ä½“ç³»ã€æ–°èŒƒå¼

# è¯„åˆ†æ ‡å‡†

- **5 åˆ†**ï¼šé‡å¤§æ–°èƒ½åŠ›/èŒƒå¼å˜åŒ–ï¼ˆå¦‚æ–°å¢ structured outputï¼‰
- **4 åˆ†**ï¼šé‡è¦åŠŸèƒ½å¢å¼º
- **3 åˆ†**ï¼šæœ‰æ„ä¹‰çš„åŠŸèƒ½è¿­ä»£
- **2 åˆ†**ï¼šå°å¹…æ”¹è¿›
- **1 åˆ†**ï¼šç»†èŠ‚ä¼˜åŒ–

# å¾…åˆ†æäº‹ä»¶

åˆ†ææ—¥æœŸï¼š{{ date }}
äº‹ä»¶æ•°é‡ï¼š{{ candidates|length }}

{% for event in candidates %}
## [{{ loop.index }}] {{ event.title }}

- **ç±»å‹**: {{ event.type }}
- **ä»“åº“**: {{ event.repo }}
- **ä½œè€…**: {{ event.author }}
- **æ—¶é—´**: {{ event.created_at }}

### æè¿°

{{ event.body }}

### å˜æ›´æ‘˜è¦

{{ event.diff_summary }}

### æ¥æº

{{ event.url }}

{% endfor %}

# è¾“å‡ºè¦æ±‚

- æ¯å¤©è¾“å‡º 5-15 æ¡é«˜è´¨é‡ä¿¡å·
- ä¼˜å…ˆé€‰æ‹©å½±å“å¤§çš„äº‹ä»¶
- why_it_matters ç”¨ 1-2 å¥è¯è§£é‡Šä»·å€¼
- æ‰€æœ‰æ¥æºå¿…é¡»æ¥è‡ªè¾“å…¥äº‹ä»¶
- é¿å…é‡å¤å’Œä½ä»·å€¼ä¿¡å·
""")

def build_analysis_prompt(candidates: list[dict], date: str | None = None) -> str:
    """æ„å»ºåˆ†æ prompt"""
    from datetime import datetime

    date = date or datetime.now().strftime("%Y-%m-%d")
    return ANALYSIS_PROMPT_TEMPLATE.render(
        date=date,
        candidates=candidates,
    )
```

### 5.6 æŠ¥å‘Šæ¸²æŸ“ï¼ˆJinja2ï¼‰

```python
# src/trendpluse/pipeline/render.py
from datetime import datetime
from pathlib import Path

from jinja2 import Environment, FileSystemLoader, select_autoescape

from ..config import settings
from ..logger import logger
from ..models.signal import DailyReport

class ReportRenderer:
    """Markdown æŠ¥å‘Šæ¸²æŸ“å™¨"""

    def __init__(self, template_dir: str = "templates"):
        self.env = Environment(
            loader=FileSystemLoader(template_dir),
            autoescape=select_autoescape(),
        )
        self.template = self.env.get_template("daily_report.md.j2")

    def render(self, report: DailyReport, date: str | None = None) -> str:
        """æ¸²æŸ“ Markdown æŠ¥å‘Š"""
        date = date or datetime.now().strftime("%Y-%m-%d")
        return self.template.render(
            date=date,
            report=report,
        )

    def save(self, report: DailyReport, date: str | None = None) -> Path:
        """ä¿å­˜æŠ¥å‘Šåˆ°æ–‡ä»¶"""
        date = date or datetime.now().strftime("%Y-%m-%d")
        output_dir = Path(settings.output_dir)
        output_dir.mkdir(parents=True, exist_ok=True)

        # æ¸²æŸ“ Markdown
        markdown = self.render(report, date)

        # ä¿å­˜ Markdown
        md_path = output_dir / f"{date}.md"
        md_path.write_text(markdown, encoding="utf-8")
        logger.info(f"Saved markdown report to {md_path}")

        # ä¿å­˜ JSON
        import json
        json_path = output_dir / f"{date}.json"
        json_path.write_text(
            report.model_dump_json(indent=2, ensure_ascii=False),
            encoding="utf-8",
        )
        logger.info(f"Saved JSON report to {json_path}")

        return md_path
```

### 5.7 é‡è¯•æœºåˆ¶ï¼ˆtenacityï¼‰

```python
# src/trendpluse/utils/retry.py
from tenacity import (
    retry,
    retry_if_exception_type,
    stop_after_attempt,
    wait_exponential,
)

from ..logger import logger

def custom_retry(fn):
    """è‡ªå®šä¹‰é‡è¯•è£…é¥°å™¨"""

    @retry(
        stop=stop_after_attempt(3),
        wait=wait_exponential(multiplier=1, min=2, max=10),
        retry=retry_if_exception_type((ConnectionError, TimeoutError)),
        before_sleep=lambda _: logger.warning("Retrying due to error..."),
    )
    def wrapper(*args, **kwargs):
        return fn(*args, **kwargs)

    return wrapper
```

---

## å…­ã€Pipeline ä¸»æµç¨‹

```python
# src/trendpluse/pipeline/__init__.py
from datetime import datetime
from pathlib import Path

from ..github.client import GitHubClient
from ..analyzer.claude import ClaudeAnalyzer
from ..config import settings
from ..logger import logger
from .filter import filter_candidates
from .render import ReportRenderer

async def run_daily_pipeline(date: str | None = None) -> Path:
    """æ‰§è¡Œæ¯æ—¥åˆ†ææµç¨‹"""

    date = date or datetime.now().strftime("%Y-%m-%d")
    logger.info(f"[bold]Starting TrendPulse pipeline for {date}[/bold]")

    # å¹‚ç­‰æ€§æ£€æŸ¥
    report_path = Path(settings.output_dir) / f"{date}.md"
    if report_path.exists():
        logger.warning(f"Report for {date} already exists, skipping")
        return report_path

    # Stage 1: Fetch
    logger.info("Stage 1: Fetching from GitHub...")
    github_client = GitHubClient()
    events = github_client.get_events(days=settings.days_to_lookback)
    logger.info(f"Found {len(events)} total events")

    # Stage 2: Filter
    logger.info("Stage 2: Filtering candidates...")
    candidates = filter_candidates(
        events,
        labels=settings.candidate_labels,
        max_count=settings.max_candidates,
    )
    logger.info(f"Filtered to {len(candidates)} candidates")

    # Stage 3: Analyze
    logger.info("Stage 3: Analyzing with Claude...")
    analyzer = ClaudeAnalyzer()

    # Token é¢„ç®—æ£€æŸ¥
    estimated_tokens = analyzer.estimate_tokens(candidates)
    if estimated_tokens > settings.daily_token_budget:
        logger.warning(
            f"Estimated tokens ({estimated_tokens}) exceed budget "
            f"({settings.daily_token_budget}), using fallback"
        )
        # TODO: å®ç°é™çº§é€»è¾‘

    report = analyzer.analyze(candidates)

    # Stage 4: Render
    logger.info("Stage 4: Rendering report...")
    renderer = ReportRenderer()
    output_path = renderer.save(report, date)

    logger.info(f"[bold green]Pipeline completed![/bold green] Report: {output_path}")
    return output_path
```

---

## ä¸ƒã€æœ¬åœ°æµ‹è¯•æ¨¡å¼

### 7.1 Mock æ•°æ®ç”Ÿæˆ

```python
# scripts/mock_data.py
from datetime import datetime, timedelta
from ..trendpluse.github.models import PullRequestEvent

def generate_mock_events(count: int = 10) -> list[PullRequestEvent]:
    """ç”Ÿæˆæ¨¡æ‹Ÿäº‹ä»¶ç”¨äºæœ¬åœ°æµ‹è¯•"""

    events = []
    for i in range(count):
        events.append(
            PullRequestEvent(
                number=100 + i,
                title=f"Mock PR #{i}",
                body=f"This is a mock pull request for testing.",
                state="merged",
                merged_at=(datetime.now() - timedelta(hours=i)).isoformat(),
                author="test-user",
                labels=["feature", "enhancement"],
                url=f"https://github.com/test/repo/pull/{100+i}",
                diff_summary="- src/test.py: modified (+10, -5)",
            )
        )

    return events
```

### 5.2 æœ¬åœ°è¿è¡Œå‘½ä»¤

```bash
# ä½¿ç”¨ uv è¿è¡Œ
uv run python -m trendpluse.main --date 2026-01-02

# ä½¿ç”¨ mock æ•°æ®ï¼ˆä¸è°ƒç”¨ APIï¼‰
uv run python -m trendpluse.main --mock

# é¢„è§ˆæŠ¥å‘Š
uv run mkdocs serve
```

---

## å…«ã€Makefile

```makefile
# Makefile
.PHONY: install check format test run clean

install:
	uv sync

dev:
	uv sync --extra dev --extra docs

check:
	uv run ruff check src tests
	uv run mypy src

format:
	uv run ruff format src tests

test:
	uv run pytest tests/ -v

test-cov:
	uv run pytest tests/ --cov=src/trendpluse --cov-report=html

run:
	uv run python -m trendpluse.main

mock:
	uv run python -m trendpluse.main --mock

docs:
	uv run mkdocs build

docs-serve:
	uv run mkdocs serve

clean:
	rm -rf .pytest_cache .ruff_cache .coverage htmlcov logs
```

---

## ä¹ã€æ”¹è¿›æ€»ç»“

### 9.1 ç›¸æ¯”åŸæ–¹æ¡ˆçš„æ”¹è¿›

| æ–¹é¢ | åŸæ–¹æ¡ˆ | æ–°æ–¹æ¡ˆ |
|------|--------|--------|
| **ç»“æ„åŒ–è¾“å‡º** | Beta APIï¼ˆä¸ç¨³å®šï¼‰ | instructorï¼ˆç¨³å®šå¯é ï¼‰ |
| **é‡è¯•æœºåˆ¶** | æœªå®ç° | tenacity è£…é¥°å™¨ |
| **æ—¥å¿—ç³»ç»Ÿ** | æœªå®ç° | rich + logging |
| **é…ç½®ç®¡ç†** | pydantic-settingsï¼ˆä¸€è‡´ï¼‰ | âœ… |
| **æ¨¡æ¿å¼•æ“** | æœªå®ç° | Jinja2 |
| **GitHub å®¢æˆ·ç«¯** | æœªå®ç° | PyGithub |
| **æµ‹è¯•æ”¯æŒ** | æœªå®ç° | pytest + mock |
| **åŒ…ç®¡ç†** | requirements.txt | uv + pyproject.toml |

### 9.2 æ–°å¢åŠŸèƒ½

1. âœ… **å¹‚ç­‰æ€§ä¿éšœ**ï¼šæ£€æŸ¥æŠ¥å‘Šæ˜¯å¦å·²å­˜åœ¨
2. âœ… **Token é¢„ç®—æ£€æŸ¥**ï¼šåˆ†æå‰ä¼°ç®—æˆæœ¬
3. âœ… **æœ¬åœ°æµ‹è¯•æ¨¡å¼**ï¼šmock æ•°æ®ï¼Œä¸æ¶ˆè€— API
4. âœ… **å®Œå–„çš„é‡è¯•æœºåˆ¶**ï¼štenacity è£…é¥°å™¨
5. âœ… **Rich æ—¥å¿—ç³»ç»Ÿ**ï¼šç¾è§‚çš„ç»ˆç«¯è¾“å‡º
6. âœ… **æ¨¡æ¿åŒ–ç®¡ç†**ï¼šPrompt å’ŒæŠ¥å‘Šéƒ½ç”¨ Jinja2

---

## åã€å¿«é€Ÿå¼€å§‹

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/yourname/trendpluse.git
cd trendpluse

# 2. ä½¿ç”¨ uv å®‰è£…
uv sync --extra dev --extra docs

# 3. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env å¡«å…¥ API keys

# 4. æœ¬åœ°æµ‹è¯•ï¼ˆä½¿ç”¨ mock æ•°æ®ï¼‰
uv run python -m trendpluse.main --mock

# 5. è¿è¡ŒçœŸå®æµç¨‹
uv run python -m trendpluse.main

# 6. é¢„è§ˆæŠ¥å‘Š
uv run mkdocs serve
```

---

## åä¸€ã€ä¾èµ–ç‰ˆæœ¬é”å®š

ä½¿ç”¨ uv è‡ªåŠ¨ç”Ÿæˆ `uv.lock`ï¼Œç¡®ä¿å¯é‡ç°æ„å»ºï¼š

```bash
uv lock
```

è¿™å°†é”å®šæ‰€æœ‰ä¼ é€’ä¾èµ–çš„ç²¾ç¡®ç‰ˆæœ¬ï¼Œä¿è¯ CI/CD ç¯å¢ƒä¸æœ¬åœ°ä¸€è‡´ã€‚
